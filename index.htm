<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arduino Ajax I/O</title>
    <link rel="stylesheet" href="css/estilos.css" />
    <script>
      strMODO12AG = "";
      strLED1 = "";
      strLED2 = "";

      var MODO12AG_state = 0;
      var LED1_state = 0;
      var LED2_state = 0;
      function GetArduinoIO() {
        nocache = "&nocache=" + Math.random() * 1000000;
        var request = new XMLHttpRequest();
        request.onreadystatechange = function () {
          if (this.readyState == 4) {
            if (this.status == 200) {
              if (this.responseXML != null) {
                console.log("Respuestas XML");
                console.log(this.responseXML);
                // XML file received - contains analog values, switch values and LED state
                //dht11
                document.getElementById("dt").innerHTML =
                  this.responseXML.getElementsByTagName(
                    "relog"
                  )[0].childNodes[0].nodeValue;

                //dht11
                document.getElementById("T1").innerHTML =
                  this.responseXML.getElementsByTagName(
                    "digital2"
                  )[0].childNodes[0].nodeValue;

                document.getElementById("T2").innerHTML =
                  this.responseXML.getElementsByTagName(
                    "digital3"
                  )[0].childNodes[0].nodeValue;

                //BOTONES MODO HORARIO
                /*console.log("que llega del responseXML modo12ag");
                console.log(
                  this.responseXML.getElementsByTagName("MODOAG")[0]
                    .childNodes[0]
                );*/
                // modo12h ag
                if (
                  this.responseXML.getElementsByTagName("MODOAG")[0]
                    .childNodes[0].nodeValue === "on"
                ) {
                  //quito la clase ON
                  document
                    .getElementById("btnModoAG")
                    .classList.remove("btnOff");
                  //pongo la clase btnon On
                  document.getElementById("btnModoAG").classList.add("btnOn");

                  //modifico la linea en el dom
                  document.getElementById("btnModoAG").innerHTML = "Modo 12 ON";
                  MODOAG_state = 1;
                } else {
                  //quito la clase de ON
                  document
                    .getElementById("btnModoAG")
                    .classList.remove("btnOn");
                  //pongo la clase btn que es la OFF
                  document.getElementById("btnModoAG").classList.add("btnOff");

                  //modifico la linea en el dom
                  document.getElementById("btnModoAG").innerHTML =
                    "Modo 12 OFF";
                  MODOAG_state = 0;
                }

                // FOCO 1
                /*
                console.log("aqui el response de foco1");
                console.log(
                  this.responseXML.getElementsByTagName("LED")[0].childNodes[0]
                );
                */

                if (
                  this.responseXML.getElementsByTagName("LED")[0].childNodes[0]
                    .nodeValue === "on"
                ) {
                  document.getElementById("foco1-1").classList.add("svgon-1");
                  document.getElementById("foco1-1").classList.remove("svg-1");

                  //pongo clase a boton
                  //pongo la clase btnon On
                  document.getElementById("LED1").classList.add("btnOn");
                  //quito la clase Off
                  document.getElementById("LED1").classList.remove("btnOff");

                  document.getElementById("LED1").innerHTML =
                    "FOCO 1 esta encendido (D8)";
                  LED1_state = 1;
                } else {
                  document.getElementById("foco1-1").classList.add("svg-1");
                  document
                    .getElementById("foco1-1")
                    .classList.remove("svgon-1");

                  //quito la clase ON
                  document.getElementById("LED1").classList.remove("btnOn");
                  //pongo la clase btnon OFF
                  document.getElementById("LED1").classList.add("btnOff");

                  document.getElementById("LED1").innerHTML =
                    "FOCO 1 esta apagado (D8)";
                  LED1_state = 0;
                }

                // FOCO 2
                if (
                  this.responseXML.getElementsByTagName("LED")[1].childNodes[0]
                    .nodeValue === "on"
                ) {
                  document.getElementById("foco2-1").classList.add("svgon-1");
                  document.getElementById("foco2-1").classList.remove("svg-1");
                  //pongo clase a boton
                  //pongo la clase btnon On
                  document.getElementById("LED2").classList.add("btnOn");
                  //quito la clase Off
                  document.getElementById("LED2").classList.remove("btnOff");

                  document.getElementById("LED2").innerHTML =
                    "FOCO 2 esta Encendido (D9)";
                  LED2_state = 1;
                } else {
                  document.getElementById("foco2-1").classList.add("svg-1");
                  document
                    .getElementById("foco2-1")
                    .classList.remove("svgon-1");
                  //quito la clase ON
                  document.getElementById("LED2").classList.remove("btnOn");
                  //pongo la clase btnon OFF
                  document.getElementById("LED2").classList.add("btnOff");
                  document.getElementById("LED2").innerHTML =
                    "FOCO 2 esta Apagado (D9)";
                  LED2_state = 0;
                }
              }
            }
          }
        };
        // send HTTP GET request with LEDs to switch on/off if any
        request.open(
          "GET",
          "ajax_inputs" + strMODO12AG + strLED1 + strLED2 + nocache,
          true
        );
        request.send(null);
        setTimeout("GetArduinoIO()", 1000);
        strMODO12AG = "";
        strLED1 = "";
        strLED2 = "";
      }

      function modo12ag() {
        if (MODO12AG_state === 1) {
          MODO12AG_state = 0;
          strMODO12AG = "&MODOAG=0";
        } else {
          MODO12AG_state = 1;
          strMODO12AG = "&MODOAG=1";
        }
      }

      function GetButton1() {
        if (LED1_state === 1) {
          LED1_state = 0;
          strLED1 = "&LED1=0";
        } else {
          LED1_state = 1;
          strLED1 = "&LED1=1";
        }
      }
      function GetButton2() {
        if (LED2_state === 1) {
          LED2_state = 0;
          strLED2 = "&LED2=0";
        } else {
          LED2_state = 1;
          strLED2 = "&LED2=1";
        }
      }
    </script>
  </head>
  <body onload="GetArduinoIO()">
    <header>
      <h1>Mejurdino</h1>
      <h5>Hora: <span id="dt" class="relog">...</span></h5>
    </header>

    <!--Armario grande-->
    <div class="contArmario">
      <h3>Armario Grande</h3>
      <div class="bordeArmario">
        <!-- <img src="img/svg.svg" alt="" class="imgAG" />  -->

        <div class="ladosArm izq">
          <div class="contfoco1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 64">
              <title>Lightbulb</title>
              <g id="Layer_2" data-name="Layer 2">
                <g id="Layer_1-2" data-name="Layer 1">
                  <path
                    id="foco1-1"
                    class="svg-1"
                    d="M44,22a22,22,0,0,1-7.06,16.15A12.25,12.25,0,0,0,33.36,44,11.54,11.54,0,0,0,33,46l-.75,10.24a4,4,0,0,1-4,3.71H15.72a4,4,0,0,1-4-3.71L11,46.19A10.68,10.68,0,0,0,10.61,44,12.56,12.56,0,0,0,7,38.09,22,22,0,1,1,44,22Z"
                  />
                  <path
                    id="foco1-2"
                    class="svg-2"
                    d="M27,46H25V32H19V46H17V32H16a3,3,0,1,1,3-3v1h6V29a3,3,0,1,1,3,3H27Zm0-16h1a1,1,0,1,0-1-1ZM16,28a1,1,0,0,0,0,2h1V29A1,1,0,0,0,16,28Z"
                  />
                  <circle class="cls-3" cx="22" cy="60" r="4" />
                  <path
                    class="cls-4"
                    d="M33.36,44A11.54,11.54,0,0,0,33,46l-.13,1.82L32.58,52l-.3,4.13v.15a4,4,0,0,1-4,3.71H15.72a4.07,4.07,0,0,1-1.67-.36,4,4,0,0,1-2.32-3.35l0-.28-.29-4-.3-4L11,46.19A10.68,10.68,0,0,0,10.61,44Z"
                  />
                  <path
                    class="cls-5"
                    d="M33.36,44A11.54,11.54,0,0,0,33,46l-.13,1.82L11.42,52l-.3-4,20.72-4Z"
                  />
                  <path
                    class="cls-5"
                    d="M32.58,52l-.3,4.13-18.23,3.5a4,4,0,0,1-2.32-3.35l0-.28Z"
                  />
                  <path
                    class="cls-6"
                    d="M32.79,14.73a17,17,0,0,0-7-.15A16.8,16.8,0,0,0,12.22,30v.11a1,1,0,0,1-1.82.54A14.66,14.66,0,0,1,33.75,13.08,1,1,0,0,1,32.79,14.73Z"
                  />
                </g>
              </g>
            </svg>
          </div>
          <h5>T: <span id="T1" class="digital2">...</span></h5>
        </div>

        <div class="ladosArm der">
          <div class="contfoco2">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 64">
              <title>Lightbulb</title>
              <g id="Layer_2" data-name="Layer 2">
                <g id="Layer_1-2" data-name="Layer 1">
                  <path
                    id="foco2-1"
                    class="svg-1"
                    d="M44,22a22,22,0,0,1-7.06,16.15A12.25,12.25,0,0,0,33.36,44,11.54,11.54,0,0,0,33,46l-.75,10.24a4,4,0,0,1-4,3.71H15.72a4,4,0,0,1-4-3.71L11,46.19A10.68,10.68,0,0,0,10.61,44,12.56,12.56,0,0,0,7,38.09,22,22,0,1,1,44,22Z"
                  />
                  <path
                    id="foco2-2"
                    class="svg-2"
                    d="M27,46H25V32H19V46H17V32H16a3,3,0,1,1,3-3v1h6V29a3,3,0,1,1,3,3H27Zm0-16h1a1,1,0,1,0-1-1ZM16,28a1,1,0,0,0,0,2h1V29A1,1,0,0,0,16,28Z"
                  />
                  <circle class="cls-3" cx="22" cy="60" r="4" />
                  <path
                    class="cls-4"
                    d="M33.36,44A11.54,11.54,0,0,0,33,46l-.13,1.82L32.58,52l-.3,4.13v.15a4,4,0,0,1-4,3.71H15.72a4.07,4.07,0,0,1-1.67-.36,4,4,0,0,1-2.32-3.35l0-.28-.29-4-.3-4L11,46.19A10.68,10.68,0,0,0,10.61,44Z"
                  />
                  <path
                    class="cls-5"
                    d="M33.36,44A11.54,11.54,0,0,0,33,46l-.13,1.82L11.42,52l-.3-4,20.72-4Z"
                  />
                  <path
                    class="cls-5"
                    d="M32.58,52l-.3,4.13-18.23,3.5a4,4,0,0,1-2.32-3.35l0-.28Z"
                  />
                  <path
                    class="cls-6"
                    d="M32.79,14.73a17,17,0,0,0-7-.15A16.8,16.8,0,0,0,12.22,30v.11a1,1,0,0,1-1.82.54A14.66,14.66,0,0,1,33.75,13.08,1,1,0,0,1,32.79,14.73Z"
                  />
                </g>
              </g>
            </svg>
          </div>
          <h5>T: <span id="T2" class="digital3">...</span></h5>
        </div>
      </div>

      <div class="opcionesAG">
        <section class="automatico">
          <button
            type="button"
            id="btnModoAG"
            class="btnOff"
            onclick="modo12ag()"
          >
            Modo 12 init
          </button>
        </section>

        <section class="manual">
          <button type="button" id="LED1" class="btnOff" onclick="GetButton1()">
            FOCO 1 esta Apagado (D8)
          </button>

          <button type="button" id="LED2" class="btnOff" onclick="GetButton2()">
            FOCO 4 esta Apagado (D9)
          </button>
        </section>
      </div>
    </div>
  </body>
</html>
