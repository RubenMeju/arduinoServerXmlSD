<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arduino Ajax I/O</title>
    <link rel="stylesheet" href="css/estilos.css" />
    <script>
      strLED1 = "";
      strLED2 = "";
      strLED3 = "";
      strLED4 = "";
      var LED3_state = 0;
      var LED4_state = 0;
      function GetArduinoIO() {
        nocache = "&nocache=" + Math.random() * 1000000;
        var request = new XMLHttpRequest();
        request.onreadystatechange = function () {
          if (this.readyState == 4) {
            if (this.status == 200) {
              if (this.responseXML != null) {
                console.log("Respuestas XML");
                console.log(this.responseXML);
                // XML file received - contains analog values, switch values and LED state
                //dht11
                document.getElementById("T1").innerHTML =
                  this.responseXML.getElementsByTagName(
                    "digital2"
                  )[0].childNodes[0].nodeValue;

                document.getElementById("T2").innerHTML =
                  this.responseXML.getElementsByTagName(
                    "digital3"
                  )[0].childNodes[0].nodeValue;

                // get switch inputs
                var num_an =
                  this.responseXML.getElementsByTagName("switch").length;
                for (count = 0; count < num_an; count++) {
                  document.getElementsByClassName("switches")[count].innerHTML =
                    this.responseXML.getElementsByTagName("switch")[
                      count
                    ].childNodes[0].nodeValue;
                }
                // LED 1
                if (
                  this.responseXML.getElementsByTagName("LED")[0].childNodes[0]
                    .nodeValue === "checked"
                ) {
                  document.LED_form.LED1.checked = true;
                } else {
                  document.LED_form.LED1.checked = false;
                }
                // LED 2
                if (
                  this.responseXML.getElementsByTagName("LED")[1].childNodes[0]
                    .nodeValue === "checked"
                ) {
                  document.LED_form.LED2.checked = true;
                } else {
                  document.LED_form.LED2.checked = false;
                }
                // FOCO 1
                if (
                  this.responseXML.getElementsByTagName("LED")[2].childNodes[0]
                    .nodeValue === "on"
                ) {
                  document.getElementById("foco1").src = "img/focoon.png";
                  document.getElementById("LED3").innerHTML =
                    "FOCO 1 esta encendido (D8)";
                  LED3_state = 1;
                } else {
                  document.getElementById("foco1").src = "img/focooff.png";
                  document.getElementById("LED3").innerHTML =
                    "FOCO 1 esta apagado (D8)";
                  LED3_state = 0;
                }
                // FOCO 4
                if (
                  this.responseXML.getElementsByTagName("LED")[3].childNodes[0]
                    .nodeValue === "on"
                ) {
                  document.getElementById("foco2").src = "img/focoon.png";
                  document.getElementById("LED4").innerHTML =
                    "FOCO 4 esta Encendido (D9)";
                  LED4_state = 1;
                } else {
                  document.getElementById("foco2").src = "img/focooff.png";
                  document.getElementById("LED4").innerHTML =
                    "FOCO 4 esta Apagado (D9)";
                  LED4_state = 0;
                }
              }
            }
          }
        };
        // send HTTP GET request with LEDs to switch on/off if any
        request.open(
          "GET",
          "ajax_inputs" + strLED1 + strLED2 + strLED3 + strLED4 + nocache,
          true
        );
        request.send(null);
        setTimeout("GetArduinoIO()", 1000);
        strLED1 = "";
        strLED2 = "";
        strLED3 = "";
        strLED4 = "";
      }
      // service LEDs when checkbox checked/unchecked
      function GetCheck() {
        if (LED_form.LED1.checked) {
          strLED1 = "&LED1=1";
        } else {
          strLED1 = "&LED1=0";
        }
        if (LED_form.LED2.checked) {
          strLED2 = "&LED2=1";
        } else {
          strLED2 = "&LED2=0";
        }
      }
      function GetButton1() {
        if (LED3_state === 1) {
          LED3_state = 0;
          strLED3 = "&LED3=0";
        } else {
          LED3_state = 1;
          strLED3 = "&LED3=1";
        }
      }
      function GetButton2() {
        if (LED4_state === 1) {
          LED4_state = 0;
          strLED4 = "&LED4=0";
        } else {
          LED4_state = 1;
          strLED4 = "&LED4=1";
        }
      }
    </script>
  </head>
  <body onload="GetArduinoIO()">
    <header>
      <h1>Mejurdino</h1>
    </header>

    <!--Armario grande-->
    <div class="contArmario">
      <h3>Armario Grande</h3>
      <div class="bordeArmario">
        <!-- <img src="img/svg.svg" alt="" class="imgAG" />  -->

        <div class="ladosArm izq">
          <div class="contfoco1">
            <img
              src="img/focooff.png"
              alt="Bombilla"
              id="foco1"
              class="imgFoco"
            />
           
          </div>
          <h5>T: <span id="T1" class="digital2">...</span></h5>
        </div>

        <div class="ladosArm der">
          <div class="contfoco2">
            <img
              src="img/focooff.png"
              alt="Bombilla"
              id="foco2"
              class="imgFoco"
            />
            
          </div>
          <h5>T: <span id="T2" class="digital3">...</span></h5>
        </div>
      </div>

      <div class="opcionesAG">
        <button type="button" id="LED3" onclick="GetButton1()">
          FOCO 1 esta Apagado (D8)
        </button>

        <button type="button" id="LED4" onclick="GetButton2()">
          FOCO 4 esta Apagado (D9)
        </button>
      </div>
    </div>

    
    <div class="sensores">
      <div class="IO_box">
        <h3>Switch Inputs</h3>
        <h5 class="small_text">D0: used by serial RX</h5>
        <h5 class="small_text">D1: used by serial TX</h5>
        <h5>Switch 1 (D2): <span class="switches">...</span></h5>
        <h5>Switch 2 (D3): <span class="switches">...</span></h5>
        <h5 class="small_text">D4: used by Ethernet shield</h5>
        <h5>Switch 3 (D5): <span class="switches">...</span></h5>
      </div>

      <div class="IO_box">
        <h3>LEDs con Checkboxes</h3>
        <form id="check_LEDs" name="LED_form">
          <input
            type="checkbox"
            name="LED1"
            value="0"
            onclick="GetCheck()"
          />LED 1 (D6)<br /><br />
          <input
            type="checkbox"
            name="LED2"
            value="0"
            onclick="GetCheck()"
          />LED 2 (D7)<br /><br />
        </form>
      </div>
    </div>
  </body>
</html>
